!function(){console.groupCollapsed("Config version"),console.log("SchoolStore  %s (%s)",SchoolStore.VERSION,SchoolStore.HASH),console.log("InfinniUI    %s",InfinniUI.VERSION),console.groupEnd(),SchoolStore.common.isNullOrWhiteSpace=function(e){return!Boolean(e)||/^\s+$/.test(e)},SchoolStore.common.getValidationErrors=function(e){var t={Items:[]};return _.each(e,function(e){SchoolStore.common.isNullOrWhiteSpace(e.field)&&t.Items.push({Message:e.message||'Поле "'+e.caption+'" обязательно для заполнения.'})}),t.IsValid=0===t.Items.length,t},SchoolStore.common.serviceCaptionLabelTextConverter=function(e,t){if(void 0===t.binding.getElement().getTag())return"";var o=t.binding.attributes.sourceProperty,r=_.last(o.split("."));return"ServiceProviderPreview"===t.binding.getElement().getTag()?parseInt(r,10)+1:"Услуга "+(parseInt(r,10)+1)},SchoolStore.scripts.startPageOnLoaded=function(e,t){InfinniUI.user.onReady(function(e){SchoolStore.currentUser=e,InfinniUI.RouterService.setParams({user:e}),InfinniUI.RouterService.startRouter()})},SchoolStore.scripts.catalogGoodsCatalogGoodsViewDeleteButtonOnClick=function(e,t){function o(){e.global.executeAction(e,{DeleteAction:{Accept:!1,DestinationValue:{Source:"CatalogGoodsDataSource",Property:"$"}}})}var r=e.dataSources.CatalogGoodsDataSource.getSelectedItem(),a=e.dataSources.ServiceProviderDataSource.getItems();if("ROOT_CATEGORY"===r.ParentId){_.find(a,function(e){return e.CategoryId===r._id})?toastr.error("Категория, содержащая поставщиков, не может быть удалена"):new InfinniUI.MessageBox({type:"error",text:"Подтвердите удаление категории",buttons:[{name:"Ок",onClick:o},{name:"Отмена"}]})}else{_.find(a,function(e){return _.find(e.SubCategories,function(e){return e.CategoryId===r._id})})?toastr.error("Подкатегория, содержащая поставщиков, не может быть удалена"):new InfinniUI.MessageBox({type:"error",text:"Подтвердите удаление подкатегории",buttons:[{name:"Ок",onClick:o},{name:"Отмена"}]})}},SchoolStore.scripts.catalogGoodsCategoryGoodsEditViewConverterLabelText=function(e,t){return"add"===t.value?e.dataSources.CatalogGoodsDataSource.getSelectedItem().ParentId?"Добавить подкатегорию":"Добавить категорию":"ROOT_CATEGORY"===e.dataSources.CatalogGoodsDataSource.getSelectedItem().ParentId?"Редактировать категорию":"Редактировать подкатегорию"},SchoolStore.scripts.catalogGoodsCategoryGoodsEditViewOnLoaded=function(e,t){"add"===e.parameters.Type.getValue()&&e.dataSources.CatalogGoodsDataSource.setProperty("$.ParentId",e.parameters.CategoryType.getValue()._id)},SchoolStore.scripts.catalogGoodsCategoryGoodsEditViewSaveButtonOnClick=function(e,t){var o=e.dataSources.CatalogGoodsDataSource.getItems(),r=_.filter(o,function(e){return e.Name});if(0===r.length)return void toastr.error('Поле "Название" не может быть пустым');e.dataSources.AddCategoryDataSource.createItem(),e.dataSources.AddCategoryDataSource.setProperty("$.DirectoryCategories",r),e.global.executeAction(e,{SaveAction:{DestinationValue:{Source:"AddCategoryDataSource"}}})},SchoolStore.scripts.homePageSignOutButtonOnClick=function(e,t){InfinniUI.global.session.signOut(function(){window.location.reload()})},SchoolStore.scripts.signInViewMainDataSourceOnPropertyChanged=function(e,t){var o=t.source.getSelectedItem(),r=e.controls.SignInButton;r&&(o&&o.username&&o.password?r.setEnabled(!0):r.setEnabled(!1))},SchoolStore.scripts.signInViewSignInButtonOnClick=function(e,t){var o=e.dataSources.MainDataSource.getSelectedItem();InfinniUI.global.session.signInInternal(o.username,o.password,o.passwordRemember,function(t){SchoolStore.currentUser=t,InfinniUI.RouterService.setParams({user:t}),SchoolStore.router.goToUrl(e,{path:"/",replace:!0})},function(){toastr.error("Неверный логин или пароль")})},SchoolStore.scripts.serviceProviderViewCityComboBoxOnValueChanged=function(e,t){var o=t.newValue?InfinniUI.StringUtils.format("eq(CityId,'{0}')",[t.newValue._id]):"";e.dataSources.ServiceProviderDataSource.setFilter(o)},SchoolStore.scripts.serviceProviderViewImageBoxOnClick=function(e,t){var o=t.source.getTag();e.dataSources.ServiceProviderDataSource.setSelectedItem(o),e.global.executeAction(e,{RouteToAction:{Name:"ServiceProviderPreviewRoute",Params:[{Name:"Id",Value:{Source:"ServiceProviderDataSource",Property:"$._id"}}]}})},SchoolStore.scripts.serviceProviderViewSortSuppliersOnClick=function(e,t){"DateOfCreation"===t.source.getTag()?(e.dataSources.ServiceProviderDataSource.setOrder("desc(_header._created)"),e.controls.DateOfCreationButton.setBackground("primary1"),e.controls.AlphabetButton.setBackground("")):(e.dataSources.ServiceProviderDataSource.setOrder("asc(Name)"),e.controls.AlphabetButton.setBackground("primary1"),e.controls.DateOfCreationButton.setBackground(""))},SchoolStore.scripts.serviceProviderEditViewAddServiceButtonOnClick=function(e,t){var o=e.dataSources.MainDataSource,r=o.getProperty("$.Services");r.push({}),o.setProperty("$.Services",_.clone(r))},SchoolStore.scripts.serviceProviderEditViewHeaderLabelTextConverter=function(e,t){return t.value&&t.value._header?"Редактирование поставщика":"Создание поставщика"},SchoolStore.scripts.serviceProviderEditViewMainDataSourceOnSuccess=function(e,t){t.item._header?(e.global.executeAction(e,{RouteToAction:{Name:"ServiceProviderPreviewRoute",Params:[{Name:"Id",Value:{Source:"MainDataSource",Property:"$._id"}}]}}),toastr.success("Поставщик успешно изменён")):(e.global.executeAction(e,{RouteToAction:{Name:"ServiceProviderPreviewRoute",Params:[{Name:"Id",Value:{Source:"MainDataSource",Property:"$._id"}}]}}),toastr.success("Поставщик успешно создан"))},SchoolStore.scripts.serviceProviderEditViewMainDataSourceValidationErrors=function(e,t){var o=SchoolStore.common.getValidationErrors([{field:t.Name,caption:"Название"},{field:t.Address,caption:"Адрес"},{field:t.CityId,caption:"Город"},{field:t.Description,caption:"Описание"},{field:t.Email,caption:"E-mail"},{field:t.Phone,caption:"Телефон"},{field:t.CategoryId,caption:"Категория"}]),r=e.dataSources.MainDataSource.getProperty("$.Services");return _.all(r,function(e){return!SchoolStore.common.isNullOrWhiteSpace(e.Name)&&!SchoolStore.common.isNullOrWhiteSpace(e.Description)})||(o.IsValid=!1,o.Items.push({Message:"Заполнены не все услуги."})),o},SchoolStore.scripts.serviceProviderEditViewOnLoaded=function(e,t){var o=e.dataSources.MainDataSource.getSelectedItem();!function(e){return void 0!==e._header}(o)?e.dataSources.MainDataSource.setProperty("$.Services",[{}]):(e.controls.CityComboBox.setValue(o.City),e.controls.CategoryComboBox.setValue(o.Category))},SchoolStore.scripts.serviceProviderEditViewRemoveServiceButtonOnClick=function(e,t){var o=t.source.getTag(),r=e.dataSources.MainDataSource.getProperty("$.Services");_.indexOf(r,o)<1||(r=_.reject(r,function(e){return e===o}),e.dataSources.MainDataSource.setProperty("$.Services",r))},SchoolStore.scripts.serviceProviderEditViewRemoveServiceButtonVisibleConverter=function(e,t){var o=t.binding.attributes.sourceProperty;return"0"!==_.last(o.split("."))},SchoolStore.scripts.serviceProviderEditViewServiceCaptionLabelTextConverter=function(e,t){var o=t.binding.attributes.sourceProperty,r=_.last(o.split("."));return"Услуга "+(parseInt(r,10)+1)},SchoolStore.scripts.serviceProviderEditViewSubCategoriesDataSourceOnItemsUpdated=function(e,t){var o=e.dataSources.MainDataSource,r=o.getProperty("$.CategoryId"),a=o.getProperty("$.SubCategories")||[];if(r){if(_.any(a,function(e){return e.Category&&e.Category.ParentId===r})){var i=e.controls.SubCategoriesStackPanel.findAllChildrenByType("CheckBox"),n=_.map(a,function(e){return e.CategoryId});_.each(i,function(e){-1!==_.indexOf(n,e.getTag()._id)&&e.setValue(!0)})}else o.setProperty("$.SubCategories",[])}},SchoolStore.scripts.serviceProviderEditViewSubCategoryCheckBoxOnValueChanged=function(e,t){var o=e.dataSources.MainDataSource,r=o.getProperty("$.SubCategories")||[],a=t.source.getTag();_.any(r,function(e){return e.CategoryId===a._id})!==t.newValue&&(t.newValue?r.push({CategoryId:a._id}):r=_.reject(r,function(e){return e.CategoryId===a._id}),o.setProperty("$.SubCategories",_.clone(r)))},SchoolStore.scripts.serviceProviderPreviewDeleteButtonOnClick=function(e,t){function o(){e.global.executeAction(e,{DeleteAction:{Accept:!1,DestinationValue:{Source:"ServiceProviderDataSource",Property:"$"}}},function(){SchoolStore.router.goToUrl(e,"/providers",function(){toastr.success("Поставщик успешно удалён")})})}new InfinniUI.MessageBox({type:"error",text:"Подтвердите удаление поставщика",buttons:[{name:"Ок",onClick:o},{name:"Отмена"}]})},SchoolStore.scripts.serviceProviderPreviewServiceCaptionLabelTextConverter=function(e,t){var o=t.binding.attributes.sourceProperty,r=_.last(o.split("."));return parseInt(r,10)+1}}();