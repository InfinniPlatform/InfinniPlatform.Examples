{
  "$schema": "https://raw.githubusercontent.com/InfinniPlatform/InfinniUI-schema/master/View/View.json",
  "Name": "ServiceProviderEditView",
  "OnLoaded": "SS:OnLoaded",
  "DataSources": [
    {
      "DocumentDataSource": {
        "Name": "MainDataSource",
        "DocumentId": "ServiceProvider",
        "ValidationErrors": "SS:MainDataSourceValidationErrors",
        "Filter": "eq(_id,'<%Id%>')",
        "FilterParams": {
          "Id": {
            "Source": "DocumentId"
          }
        }
      }
    },
    {
      "DocumentDataSource": {
        "Name": "CityDataSource",
        "DocumentId": "City",
        "Filter": "regex(Name,'^<%Param%>',IgnoreCase)",
        "Order": "Name",
        "FilterParams": {
          "Param": {
            "Source": "CityComboBox",
            "Property": "autocompleteValue"
          }
        }
      }
    },
    {
      "DocumentDataSource": {
        "Name": "CategoriesDataSource",
        "DocumentId": "DirectoryCategories",
        "Order": "Name",
        "Filter": "and(eq(ParentId,'ROOT_CATEGORY'),regex(Name,'^<%RegexParam%>',IgnoreCase))",
        "FilterParams": {
          "RegexParam": {
            "Source": "CategoryComboBox",
            "Property": "autocompleteValue"
          }
        }
      }
    },
    {
      "DocumentDataSource": {
        "Name": "SubCategoriesDataSource",
        "DocumentId": "DirectoryCategories",
        "Order": "Name",
        "OnItemsUpdated": "SS:SubCategoriesDataSourceOnItemsUpdated",
        "Filter": "eq(ParentId,'<%ParentId%>')",
        "FilterParams": {
          "ParentId": {
            "Source": "MainDataSource",
            "Property": "$.CategoryId"
          }
        }
      }
    }
  ],
  "Parameters": [
    {
      "Name": "DocumentId"
    }
  ],
  "Items": [
    {
      "StackPanel": {
        "Orientation": "Horizontal",
        "ViewMode": "FormGroup",
        "Items": [
          {
            "Button": {
              "Name": "ServiceProvidersButton",
              "Text": "Поставщики",
              "ViewMode": "link",
              "Action": {
                "RouteToAction": {
                  "Name": "ServiceProvidersRoute"
                }
              }
            }
          },
          {
            "Icon": {
              "Name": "RightArrowIcon",
              "Value": "angle-right"
            }
          },
          {
            "Button": {
              "Name": "ServiceProviderNameButton",
              "ViewMode": "link",
              "Text": {
                "Source": "MainDataSource",
                "Property": "$.Name"
              },
              "Action": {
                "RouteToAction": {
                  "Name": "ServiceProviderPreviewRoute",
                  "Params": [
                    {
                      "Name": "Id",
                      "Value": {
                        "Source": "MainDataSource",
                        "Property": "$._id"
                      }
                    }
                  ]
                }
              }
            }
          },
          {
            "Icon": {
              "Name": "RightArrowIcon",
              "Value": "angle-right"
            }
          },
          {
            "Button": {
              "Name": "CreateServiceProviderButton",
              "ViewMode": "link",
              "Text": {
                "Source": "MainDataSource",
                "Property": "$",
                "DefaultValue": "Создание поставщика",
                "Mode": "ToElement",
                "Converter": {
                  "ToElement": "SS:HeaderLabelTextConverter"
                }
              }
            }
          }
        ]
      }
    },
    {
      "Panel": {
        "Name": "MainPanel",
        "HeaderTemplate": {
          "GridPanel": {
            "Items": [
              {
                "Cell": {
                  "ColumnSpan": 3
                }
              },
              {
                "Cell": {
                  "ColumnSpan": 9,
                  "Items": [
                    {
                      "Label": {
                        "Name": "HeaderLabel",
                        "Text": {
                          "Source": "MainDataSource",
                          "Property": "$",
                          "DefaultValue": "Создание поставщика",
                          "Mode": "ToElement",
                          "Converter": {
                            "ToElement": "SS:HeaderLabelTextConverter"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        "Items": [
          {
            "ScrollPanel": {
              "Items": [
                {
                  "GridPanel": {
                    "Items": [
                      {
                        "Cell": {
                          "ColumnSpan": 3,
                          "Items": [
                            {
                              "ImageBox": {
                                "Name": "ServiceProviderPhotoImageBox",
                                "Style": "schoolStore-provider-photo",
                                "AcceptTypes": [
                                  "image/png",
                                  "image/jpeg"
                                ],
                                "MaxSize": 2621440,
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Photo"
                                }
                              }
                            }
                          ]
                        }
                      },
                      {
                        "Cell": {
                          "ColumnSpan": 7,
                          "Items": [
                            {
                              "Label": {
                                "Name": "AboutLabel",
                                "Text": "О компании",
                                "TextStyle": "Title"
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderNameTextBox",
                                "LabelText": "Название*",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Name"
                                }
                              }
                            },
                            {
                              "ComboBox": {
                                "Name": "CityComboBox",
                                "LabelText": "Выбрать город*",
                                "ItemFormat": "{Name}",
                                "ValueFormat": "{Name}",
                                "Autocomplete": true,
                                "AutocompleteProperty": "Name",
                                "ShowClear": false,
                                "Items": {
                                  "Source": "CityDataSource"
                                },
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.CityId",
                                  "Mode": "ToSource",
                                  "Converter": {
                                    "ToSource": "{return args.value && args.value._id;}"
                                  }
                                }
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderAddressTextBox",
                                "LabelText": "Адрес*",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Address"
                                }
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderDescriptionTextBox",
                                "LabelText": "Описание*",
                                "Multiline": true,
                                "LineCount": 3,
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Description"
                                }
                              }
                            },
                            {
                              "Label": {
                                "Name": "ProviderContactsLabel",
                                "Text": "Контактная информация",
                                "TextStyle": "Title"
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderSiteTextBox",
                                "LabelText": "Сайт",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Site"
                                }
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderEmailTextBox",
                                "LabelText": "E-mail*",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Email"
                                }
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderPhoneTextBox",
                                "LabelText": "Телефон*",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Phone"
                                }
                              }
                            },
                            {
                              "TextBox": {
                                "Name": "ProviderVKTextBox",
                                "LabelText": "ВКонтакте",
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.VK"
                                }
                              }
                            },
                            {
                              "Label": {
                                "Name": "ProviderCategoryLabel",
                                "Text": "Категория",
                                "TextStyle": "Title"
                              }
                            },
                            {
                              "ComboBox": {
                                "Name": "CategoryComboBox",
                                "LabelText": "Выбрать категорию*",
                                "ShowClear": false,
                                "ItemFormat": "{Name}",
                                "ValueFormat": "{Name}",
                                "Autocomplete": true,
                                "AutocompleteProperty": "Name",
                                "Items": {
                                  "Source": "CategoriesDataSource"
                                },
                                "Value": {
                                  "Source": "MainDataSource",
                                  "Property": "$.CategoryId",
                                  "Mode": "ToSource",
                                  "Converter": {
                                    "ToSource": "{return args.value && args.value._id;}"
                                  }
                                }
                              }
                            },
                            {
                              "Label": {
                                "Name": "ProviderSubCategoryLabel",
                                "Text": "Подкатегория",
                                "TextStyle": "Title"
                              }
                            },
                            {
                              "StackPanel": {
                                "Name": "SubCategoriesStackPanel",
                                "Items": {
                                  "Source": "SubCategoriesDataSource"
                                },
                                "ItemTemplate": {
                                  "CheckBox": {
                                    "Name": "SubCategoryCheckBox",
                                    "OnValueChanged": "SS:SubCategoryCheckBoxOnValueChanged",
                                    "Tag": {
                                      "Source": "SubCategoriesDataSource",
                                      "Property": "#"
                                    },
                                    "Text": {
                                      "Source": "SubCategoriesDataSource",
                                      "Property": "#.Name"
                                    }
                                  }
                                }
                              }
                            },
                            {
                              "Label": {
                                "Name": "ProviderServicesLabel",
                                "Text": "Услуги",
                                "TextStyle": "Title"
                              }
                            },
                            {
                              "StackPanel": {
                                "Items": {
                                  "Source": "MainDataSource",
                                  "Property": "$.Services"
                                },
                                "ItemTemplate": {
                                  "StackPanel": {
                                    "Items": [
                                      {
                                        "Button": {
                                          "Name": "RemoveServiceButton",
                                          "ViewMode": "link",
                                          "HorizontalAlignment": "Right",
                                          "OnClick": "SS:RemoveServiceButtonOnClick",
                                          "Tag": {
                                            "Source": "MainDataSource",
                                            "Property": "@.#"
                                          },
                                          "Visible": {
                                            "Source": "MainDataSource",
                                            "Property": "@.#",
                                            "Mode": "ToElement",
                                            "Converter": {
                                              "ToElement": "SS:RemoveServiceButtonVisibleConverter"
                                            }
                                          },
                                          "ContentTemplate": {
                                            "Icon": {
                                              "Name": "RemoveServiceButtonTimesIcon",
                                              "Value": "times"
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "Label": {
                                          "Name": "ServiceCaptionLabel",
                                          "Text": {
                                            "Source": "MainDataSource",
                                            "Property": "@.#",
                                            "Mode": "ToElement",
                                            "Converter": {
                                              "ToElement": "{return SchoolStore.common.serviceCaptionLabelTextConverter(context, args);}"
                                            }
                                          },
                                          "Tag": "ServiceProviderEditView"
                                        }
                                      },
                                      {
                                        "TextBox": {
                                          "Name": "ServiceNameTextBox",
                                          "LabelText": "Название*",
                                          "Value": {
                                            "Source": "MainDataSource",
                                            "Property": "@.#.Name"
                                          }
                                        }
                                      },
                                      {
                                        "TextBox": {
                                          "Name": "ServiceDescriptionTextBox",
                                          "LabelText": "Описание*",
                                          "Multiline": true,
                                          "LineCount": 3,
                                          "Value": {
                                            "Source": "MainDataSource",
                                            "Property": "@.#.Description"
                                          }
                                        }
                                      }
                                    ]
                                  }
                                }
                              }
                            },
                            {
                              "Button": {
                                "Name": "AddServiceButton",
                                "Text": "Добавить ещё",
                                "ViewMode": "link",
                                "OnClick": "SS:AddServiceButtonOnClick"
                              }
                            },
                            {
                              "Button": {
                                "Name": "SaveButton",
                                "Text": "Сохранить",
                                "HorizontalAlignment": "Right",
                                "Action": {
                                  "SaveAction": {
                                    "CanClose": false,
                                    "OnSuccess": "SS:MainDataSourceOnSuccess",
                                    "DestinationValue": {
                                      "Source": "MainDataSource"
                                    }
                                  }
                                }
                              }
                            }
                          ]
                        }
                      }
                    ]
                  }
                }
              ]
            }
          }
        ]
      }
    }
  ]
}
